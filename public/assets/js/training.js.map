{"version":3,"sources":["training.js"],"names":["bEdit","cm","CodeMirror","fromTextArea","document","getElementById","lineNumbers","lineWrapping","styleActiveLine","matchBrackets","mode","setSize","on","event","$","contextmenu","onItem","context","e","formatAnnotation","target","text","lbl","replace","toLowerCase","insert","getSelection","replaceSelection","Dropzone","autoDiscover","interact","draggable","inertia","restrict","restriction","endOnly","elementRect","top","left","bottom","right","autoScroll","onmove","dragMoveListener","onend","textEl","querySelector","textContent","Math","sqrt","pow","pageX","x0","pageY","y0","toFixed","x","parseFloat","getAttribute","dx","y","dy","style","webkitTransform","transform","setAttribute","window","responseNew","frm","r","setValue","content","$select","append","id","url","selectpicker","prop","getTraining","val","modal","console","error","responseRemove","selectedOption","remove","firstOption","responseSave","log","ajax","method","done","appendIDToForm","ready","selectNavItem","click","toggleClass","find","action","attr","alertMessage","dz","dropzone","maxFilesize","success","file","init","options","bind","ctrlKey","metaKey","String","fromCharCode","which","preventDefault","submit"],"mappings":"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","file":"training.js","sourcesContent":["\"use strict\";\n\nvar bEdit = false;\n\nvar cm = CodeMirror.fromTextArea(document.getElementById(\"txt-content\"), {\n  lineNumbers: true,\n  lineWrapping: true,\n  styleActiveLine: true,\n  matchBrackets: true,\n  mode: \"xml\"\n});\n\ncm.setSize('100%', '100%');\n\ncm.on('contextmenu', function (event) {\n  $('.CodeMirror').contextmenu({\n    'target': '#context-menu',\n    onItem: function onItem(context, e) {\n      formatAnnotation($(e.target).text());\n    }\n  });\n  bEdit = true;\n});\n\ncm.on('blur', function (event) {\n  bEdit = true;\n});\n\nfunction formatAnnotation(lbl) {\n  lbl = lbl.replace(/\\s+/g, '_').toLowerCase();\n\n  var insert = ' <START:' + lbl + '> ' + cm.getSelection() + ' <END> ';\n\n  cm.replaceSelection(insert);\n}\n\nif (Dropzone) {\n  Dropzone.autoDiscover = false;\n}\n\ninteract('#dlg-annotation').draggable({\n\n  inertia: true,\n\n  restrict: {\n    restriction: \"parent\",\n    endOnly: true,\n    elementRect: { top: 0, left: 0, bottom: 1, right: 1 }\n  },\n\n  autoScroll: true,\n  onmove: dragMoveListener,\n\n  onend: function onend(event) {\n    var textEl = event.target.querySelector('p');\n\n    textEl && (textEl.textContent = 'moved a distance of ' + Math.sqrt(Math.pow(event.pageX - event.x0, 2) + Math.pow(event.pageY - event.y0, 2) | 0).toFixed(2) + 'px');\n  }\n});\n\nfunction dragMoveListener(event) {\n  var target = event.target,\n      x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx,\n      y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;\n\n  // translate the element\n  target.style.webkitTransform = target.style.transform = 'translate(' + x + 'px, ' + y + 'px)';\n\n  // update the posiion attributes\n  target.setAttribute('data-x', x);\n  target.setAttribute('data-y', y);\n}\n\nwindow.dragMoveListener = dragMoveListener;\n\nfunction responseNew(frm, r) {\n\n  try {\n\n    cm.setValue(r.content);\n\n    var $select = $('#sel-training');\n\n    $select.append('<option value=\"' + r.id + '\">' + r.url + '</option>');\n\n    $select.selectpicker('refresh');\n\n    $select.selectpicker('val', r.id).prop('selected', true);\n\n    getTraining(r.id);\n\n    $('#txt-training-add').val('');\n\n    $('#mdl-add').modal('hide');\n  } catch (e) {\n\n    console.error(e);\n\n    //alertMessage()\n  }\n}\n\nfunction responseRemove(frm, r) {\n\n  try {\n\n    cm.setValue('');\n\n    var selectedOption = $('#sel-training option:selected');\n    selectedOption.remove();\n    $('#sel-training').selectpicker('refresh');\n    var firstOption = $('#sel-training option:first-child').val();\n    $('#sel-training').selectpicker('val', firstOption);\n    getTraining(firstOption);\n\n    $('#mdl-remove').modal('hide');\n\n    //console.log(firstOption);\n  } catch (e) {\n\n    console.error(e);\n    //alertMessage()\n  }\n}\n\nfunction responseSave(frm, r) {\n  console.log(r);\n  bEdit = false;\n}\n\nfunction getTraining(id) {\n\n  $.ajax({\n    method: 'GET',\n    url: '/jobs/' + $('#txt-job').val() + '/training/?t=' + id\n  }).done(function (r) {\n    try {\n      cm.setValue(r.content);\n\n      console.log(r.id);\n\n      $('#txt-training').val(r.id);\n\n      appendIDToForm($('#frm-training'), r.id);\n\n      bEdit = true;\n    } catch (e) {\n      console.error(e);\n    }\n  });\n}\n\n$(function () {\n\n  //Show Jobs nav item\n  $(document).ready(function () {\n    selectNavItem('jobs');\n  });\n\n  //Show annotations dialog\n  $('.btn-annotation').click(function () {\n    $('#dlg-annotation').toggleClass('d-none');\n  });\n\n  //Insert annotation\n  $('#btn-annotate').click(function () {\n    formatAnnotation($('#sel-targets').find(\"option:selected\").text());\n  });\n\n  //Set up remove dialog\n  $('#mdl-remove').on('shown.bs.modal', function () {\n\n    appendIDToForm($(this).find('form'), $('#txt-training').val());\n\n    $('#txt-training-remove').val($('#sel-training').find(\"option:selected\").text());\n  });\n\n  $('.btn-build').click(function () {\n    var action = $(this).attr('data-action');\n    $.ajax({\n      method: 'GET',\n      url: '/jobs/' + $('#txt-job').val() + '/build/?act=' + action\n    }).done(function (r) {\n      console.log(r);\n\n      try {\n        alertMessage(r);\n        //  cm.setValue(r.content);\n        //  console.log(r.id);\n        //$('#txt-training').val(r.id);\n        //bEdit = true;\n      } catch (e) {\n        console.error(e);\n      }\n    });\n  });\n\n  //Training selected\n  $('#sel-training').on('changed.bs.select', function () {\n    getTraining($('#sel-training').val());\n  });\n\n  //File upload Drop Zone\n  var dz = $(\"div.dz\").dropzone({\n    maxFilesize: 100,\n    url: '/jobs/' + $('#txt-job').val() + '/training?url=' + $('#sel-training').val() + '&new=',\n    success: function success(file, r) {\n      cm.setValue(r['content']);\n    },\n    init: function init() {\n      this.on(\"processing\", function (file) {\n        this.options.url += $('#chk-new').attr('data-value');\n      });\n    }\n  });\n\n  $(window).bind('keydown', function (event) {\n    if (event.ctrlKey || event.metaKey) {\n      if (String.fromCharCode(event.which).toLowerCase() == 's') {\n        event.preventDefault();\n        $('#frm-training').submit();\n      }\n    }\n  });\n});\n//# sourceMappingURL=training.js.map\n//# sourceMappingURL=training.js.map\n"]}