{"version":3,"sources":["results.js"],"names":["docID","rowIndex","cm","CodeMirror","fromTextArea","document","getElementById","mode","lineNumbers","lineWrapping","indentWithTabs","smartIndent","autofocus","setSize","cm_add","col","newText","doc","getDoc","cursor","getCursor","replaceRange","responseAdd","$frm","response","html","$","each","fields","key","value","before","responseEdit","$row","val","n","find","text","responseRemove","remove","responseRefresh","$table","tr","r","row","item_id","c","append","getColumns","columns","push","attr","populateSelectItems","cntrl","ex","Array","end","th","inArray","selectpicker","populateSelectDocs","trim","ajax","method","url","done","name","replace","on","e","alertSpin","target","resizable","alertResponse","click","result","queryBuilder","isEmptyObject","data","JSON","stringify","contentType","dataType","alertMessage","getValue","$btn","sel","parent","$doc","$modalBody","console","log","index","removeClass"],"mappings":"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","file":"results.js","sourcesContent":["'use strict';\n\nvar docID;\nvar rowIndex;\n\n// Code Mirror Config\nvar cm = CodeMirror.fromTextArea(document.getElementById(\"txt-locate\"), {\n  mode: \"twig\",\n  lineNumbers: false,\n  lineWrapping: false,\n  indentWithTabs: false,\n  smartIndent: false,\n  autofocus: true\n});\n\ncm.setSize(null, 100);\n\n//Add text to locate formular\nfunction cm_add(cm, col, newText) {\n  var doc = cm.getDoc();\n  var cursor = doc.getCursor();\n  doc.replaceRange('{{' + col + '.' + newText + '}}', cursor);\n}\n\nfunction responseAdd($frm, response) {\n  var html = '<tr data-id=\"' + response['id'] + '\">';\n  $.each(response.fields, function (key, value) {\n    html += '<td class=\"ui-resizable\">' + value + '</td>';\n  });\n\n  $('.table > tbody > tr:first').before(html + '</tr>');\n}\n\nfunction responseEdit($frm, response) {\n  var $row = $('.table > tbody > tr:eq(' + $('#txt-selected').val() + ')');\n  var n = 2;\n  $.each(response['row'], function (key, value) {\n    $row.find('td:nth-child(' + n + ')').text(value);\n    n++;\n  });\n}\n\nfunction responseRemove($frm, response) {\n  var $row = $('.table > tbody > tr:eq(' + $('.txt-selected').val() + ')');\n  $row.remove();\n}\n\nfunction responseRefresh($frm, response) {\n  var $table = $(\"table.table\");\n  var tr = '';\n  $table.find(\"tbody tr\").remove();\n  $.each(response['results'], function (r, row) {\n    tr = '<tr data-id=' + row.item_id + '>';\n    $.each(row, function (c, col) {\n      tr += '<td>' + col + '</td>';\n    });\n    tr += '</tr>';\n    $table.find('tbody').append(tr);\n  });\n}\n\nfunction getColumns() {\n  var columns = [];\n  $('.table th').each(function () {\n    columns.push({\n      'id': $(this).attr('data-field'),\n      'label': $(this).find('a').text(),\n      'type': 'string'\n    });\n  });\n  return columns;\n}\n\n//locate dialog, populate items selectpicker control from table headings\nfunction populateSelectItems(cntrl) {\n  //exclude columns\n  var ex = Array('item_id', 'document_id', 'lat', 'lng');\n\n  //remove any options\n  cntrl.find('option').remove().end();\n\n  //for each table header\n  $(\".table th\").each(function () {\n\n    var th = $(this).attr('data-field');\n\n    if ($.inArray(th, ex) == -1) {\n      cntrl.append('<option value=\"' + th + '\">' + $(this).find('a').text() + '</option>');\n    }\n  });\n\n  cntrl.selectpicker(\"refresh\");\n}\n\n//locate dialog, populate documents selectpicker control with document data\nfunction populateSelectDocs(cntrl) {\n\n  var docID = $('.table td:eq(1)').text().trim();\n\n  cntrl.find('option').remove().end();\n\n  $.ajax({\n    method: 'GET',\n    url: 'documents/' + docID\n  }).done(function (r) {\n    $.each(r['doc']['meta'], function (key, value) {\n      cntrl.append('<option value=\"' + value.name + '\">' + value.name.replace('document_', '') + '</option>');\n    });\n    $('#sel-locate-docs').selectpicker(\"refresh\");\n  });\n}\n\n$(function () {\n\n  //Pagination page click\n  $('.pagination a').on('click', function (e) {\n    alertSpin();\n    $.ajax({\n      method: 'GET',\n      url: 'results/result?page=' + $(e.target).text()\n    }).done(function (r) {\n      $('table.table').html(r['content']);\n      $('.table td').resizable();\n      alertResponse(r);\n    });\n  });\n\n  //Submit filter form\n  $('#btn-filter').click(function () {\n    var result = $('#builder').queryBuilder('getRules');\n    if (!$.isEmptyObject(result)) {\n      $.ajax({\n        method: 'POST',\n        url: 'results/filter',\n        data: JSON.stringify(result, null, 2),\n        contentType: \"application/json; charset=utf-8\",\n        dataType: \"json\"\n      }).done(function (r) {\n        alertMessage(r);\n        if (r['code'] == 200) {\n          responseRefresh(r);\n        }\n      });\n    }\n  });\n\n  //Post location -> lat/long for each row\n  $('#btn-locate-ok').on('click', function () {\n    $.ajax({\n      method: 'POST',\n      url: 'results/locate?code=' + cm.getValue()\n    }).done(function (r) {\n      alertResponse(r);\n    });\n  });\n\n  //Locate, add selectpicker to location formular\n  $(\".btn-locate\").on('click', function () {\n    var $btn = $(this);\n    //selected item\n    var sel = $btn.parent('div').parent('div.row').find('.selectpicker').val();\n    //add it at cursor\n    cm_add(cm, $btn.attr('data-source'), sel);\n  });\n\n  //Export - Solr/Sheets/DB\n  $('.btn-export').click(function (e) {\n    $.ajax({\n      method: 'GET',\n      url: $(this).attr('href')\n    }).done(function (r) {\n      alertResponse(r);\n    });\n  });\n\n  //Set up document dialog\n  $('.document-id').click(function (e) {\n\n    var $doc = $(this);\n\n    var $modalBody = $('#mdl-document').find('.modal-body');\n\n    $modalBody.html('');\n\n    $.ajax({\n      method: 'GET',\n      url: $doc.attr('href')\n    }).done(function (r) {\n\n      $.each(r['doc']['meta'], function (key, value) {\n        console.log(value.value);\n        var html = '<div class=\"form-group\">' + '<label for=\"name\" style=\"text-transform: capitalize\">' + value.name.replace('_', ' ') + '</label>' + '<input type=\"text\" class=\"form-control\" readonly value=\"' + value.value + '\">' + '</div>';\n\n        $modalBody.append(html);\n      });\n    });\n  });\n\n  //Show edit modal, populate fields\n  $('#mdl-edit').on('shown.bs.modal', function () {\n    var $row = $('table.table tr[data-id=\"' + $('.txt-selected').val() + '\"]').find('td');\n    $row.each(function (index) {\n      var col = $('table.table th:eq(' + index + ')').attr('data-field');\n      $('#mdl-edit .txt-' + col).val($(this).text().trim());\n    });\n  });\n\n  //Filter modal show (populate selects)\n  $('#mdl-filter').on('shown.bs.modal', function () {\n    $('#builder').queryBuilder({\n      \"filters\": getColumns()\n    });\n    $('#builder').removeClass('form-inline');\n  });\n\n  //Show location modal (populate selects)\n  $(\"#mdl-locate\").on('shown.bs.modal', function () {\n\n    populateSelectItems($('#sel-locate-item'));\n\n    populateSelectDocs($('#sel-locate-docs'));\n  });\n});\n//# sourceMappingURL=results.js.map\n//# sourceMappingURL=results.js.map\n"]}