"use strict";var bEdit=!1,cm=CodeMirror.fromTextArea(document.getElementById("txt-content"),{lineNumbers:!0,lineWrapping:!0,styleActiveLine:!0,matchBrackets:!0,mode:"xml"});function formatAnnotation(t){var e=" <START:"+(t=t.replace(/\s+/g,"_").toLowerCase())+"> "+cm.getSelection()+" <END> ";cm.replaceSelection(e)}function dragMoveListener(t){var e=t.target,n=(parseFloat(e.getAttribute("data-x"))||0)+t.dx,o=(parseFloat(e.getAttribute("data-y"))||0)+t.dy;e.style.webkitTransform=e.style.transform="translate("+n+"px, "+o+"px)",e.setAttribute("data-x",n),e.setAttribute("data-y",o)}function responseNew(t,e){try{cm.setValue(e.content);var n=$("#sel-training");n.append('<option value="'+e.id+'">'+e.url+"</option>"),n.selectpicker("refresh"),n.selectpicker("val",e.id).prop("selected",!0),getTraining(e.id),$("#txt-training-add").val(""),$("#mdl-add").modal("hide")}catch(t){console.error(t)}}function responseRemove(t,e){try{cm.setValue(""),$("#sel-training option:selected").remove(),$("#sel-training").selectpicker("refresh");var n=$("#sel-training option:first-child").val();$("#sel-training").selectpicker("val",n),getTraining(n),$("#mdl-remove").modal("hide")}catch(t){console.error(t)}}function responseSave(t,e){console.log(e),bEdit=!1}function getTraining(t){$.ajax({method:"GET",url:"/jobs/"+$("#txt-job").val()+"/training/?t="+t}).done(function(t){try{cm.setValue(t.content),console.log(t.id),$("#txt-training").val(t.id),appendIDToForm($("#frm-training"),t.id),bEdit=!0}catch(t){console.error(t)}})}cm.setSize("100%","100%"),cm.on("contextmenu",function(t){$(".CodeMirror").contextmenu({target:"#context-menu",onItem:function(t,e){formatAnnotation($(e.target).text())}}),bEdit=!0}),cm.on("blur",function(t){bEdit=!0}),Dropzone&&(Dropzone.autoDiscover=!1),interact("#dlg-annotation").draggable({inertia:!0,restrict:{restriction:"parent",endOnly:!0,elementRect:{top:0,left:0,bottom:1,right:1}},autoScroll:!0,onmove:dragMoveListener,onend:function(t){var e=t.target.querySelector("p");e&&(e.textContent="moved a distance of "+Math.sqrt(Math.pow(t.pageX-t.x0,2)+Math.pow(t.pageY-t.y0,2)|0).toFixed(2)+"px")}}),window.dragMoveListener=dragMoveListener,$(function(){$(document).ready(function(){selectNavItem("jobs")}),$(".btn-annotation").click(function(){$("#dlg-annotation").toggleClass("d-none")}),$("#btn-annotate").click(function(){formatAnnotation($("#sel-targets").find("option:selected").text())}),$("#mdl-remove").on("shown.bs.modal",function(){appendIDToForm($(this).find("form"),$("#txt-training").val()),$("#txt-training-remove").val($("#sel-training").find("option:selected").text())}),$(".btn-build").click(function(){var t=$(this).attr("data-action");$.ajax({method:"GET",url:"/jobs/"+$("#txt-job").val()+"/build/?act="+t}).done(function(t){console.log(t);try{alertMessage(t)}catch(t){console.error(t)}})}),$("#sel-training").on("changed.bs.select",function(){getTraining($("#sel-training").val())});$("div.dz").dropzone({maxFilesize:100,url:"/jobs/"+$("#txt-job").val()+"/training?url="+$("#sel-training").val()+"&new=",success:function(t,e){cm.setValue(e.content)},init:function(){this.on("processing",function(t){this.options.url+=$("#chk-new").attr("data-value")})}});$(window).bind("keydown",function(t){(t.ctrlKey||t.metaKey)&&"s"==String.fromCharCode(t.which).toLowerCase()&&(t.preventDefault(),$("#frm-training").submit())})});