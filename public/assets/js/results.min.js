"use strict";var docID,rowIndex,cm=CodeMirror.fromTextArea(document.getElementById("txt-locate"),{mode:"twig",lineNumbers:!1,lineWrapping:!1,indentWithTabs:!1,smartIndent:!1,autofocus:!0});function cm_add(e,t,n){var a=e.getDoc(),o=a.getCursor();a.replaceRange("{{"+t+"."+n+"}}",o)}function responseAdd(e,t){var n='<tr data-id="'+t.id+'">';$.each(t.fields,function(e,t){n+='<td class="ui-resizable">'+t+"</td>"}),$(".table > tbody > tr:first").before(n+"</tr>")}function responseEdit(e,t){var n=$(".table > tbody > tr:eq("+$("#txt-selected").val()+")"),a=2;$.each(t.row,function(e,t){n.find("td:nth-child("+a+")").text(t),a++})}function responseRemove(e,t){$(".table > tbody > tr:eq("+$(".txt-selected").val()+")").remove()}function responseRefresh(e,t){var n=$("table.table"),a="";n.find("tbody tr").remove(),$.each(t.results,function(e,t){a="<tr data-id="+t.item_id+">",$.each(t,function(e,t){a+="<td>"+t+"</td>"}),a+="</tr>",n.find("tbody").append(a)})}function getColumns(){var e=[];return $(".table th").each(function(){e.push({id:$(this).attr("data-field"),label:$(this).find("a").text(),type:"string"})}),e}function populateSelectItems(t){var n=Array("item_id","document_id","lat","lng");t.find("option").remove().end(),$(".table th").each(function(){var e=$(this).attr("data-field");-1==$.inArray(e,n)&&t.append('<option value="'+e+'">'+$(this).find("a").text()+"</option>")}),t.selectpicker("refresh")}function populateSelectDocs(n){var e=$(".table td:eq(1)").text().trim();n.find("option").remove().end(),$.ajax({method:"GET",url:"documents/"+e}).done(function(e){$.each(e.doc.meta,function(e,t){n.append('<option value="'+t.name+'">'+t.name.replace("document_","")+"</option>")}),$("#sel-locate-docs").selectpicker("refresh")})}cm.setSize(null,100),$(function(){$(".pagination a").on("click",function(e){alertSpin(),$.ajax({method:"GET",url:"results/result?page="+$(e.target).text()}).done(function(e){$("table.table").html(e.content),$(".table td").resizable(),alertResponse(e)})}),$("#btn-filter").click(function(){var e=$("#builder").queryBuilder("getRules");$.isEmptyObject(e)||$.ajax({method:"POST",url:"results/filter",data:JSON.stringify(e,null,2),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(e){alertMessage(e),200==e.code&&responseRefresh(e)})}),$("#btn-locate-ok").on("click",function(){$.ajax({method:"POST",url:"results/locate?code="+cm.getValue()}).done(function(e){alertResponse(e)})}),$(".btn-locate").on("click",function(){var e=$(this),t=e.parent("div").parent("div.row").find(".selectpicker").val();cm_add(cm,e.attr("data-source"),t)}),$(".btn-export").click(function(e){$.ajax({method:"GET",url:$(this).attr("href")}).done(function(e){alertResponse(e)})}),$(".document-id").click(function(e){var t=$(this),a=$("#mdl-document").find(".modal-body");a.html(""),$.ajax({method:"GET",url:t.attr("href")}).done(function(e){$.each(e.doc.meta,function(e,t){console.log(t.value);var n='<div class="form-group"><label for="name" style="text-transform: capitalize">'+t.name.replace("_"," ")+'</label><input type="text" class="form-control" readonly value="'+t.value+'"></div>';a.append(n)})})}),$("#mdl-edit").on("shown.bs.modal",function(){$('table.table tr[data-id="'+$(".txt-selected").val()+'"]').find("td").each(function(e){var t=$("table.table th:eq("+e+")").attr("data-field");$("#mdl-edit .txt-"+t).val($(this).text().trim())})}),$("#mdl-filter").on("shown.bs.modal",function(){$("#builder").queryBuilder({filters:getColumns()}),$("#builder").removeClass("form-inline")}),$("#mdl-locate").on("shown.bs.modal",function(){populateSelectItems($("#sel-locate-item")),populateSelectDocs($("#sel-locate-docs"))})});