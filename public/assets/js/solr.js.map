{"version":3,"sources":["solr.js"],"names":["ItemMap","bounds","map","Grid","table","init","selector","center","zoom","usr","pwd","map_options","mapTypeId","google","maps","MapTypeId","ROADMAP","Map","$","LatLngBounds","draw","data","each","key","doc","lat","parseFloat","lng","p","LatLng","extend","m","mark","infoWindow","InfoWindow","html","ex","k","v","inArray","event","addListener","setContent","open","panTo","Marker","position","append","document","ready","selectNavItem","length","val","ajax","url","dataType","headers","btoa","done","r","docs","on","toggle","find","toggleClass","location","text","toggleHelp","hide","showError","response","console","log","fadeIn","prepend"],"mappings":"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","file":"solr.js","sourcesContent":["'use strict';\n\nvar ItemMap = {\n  bounds: null,\n  map: null\n};\n\nvar Grid = {\n  table: null\n};\n\nvar map;\n\nItemMap.init = function (selector, center, zoom, usr, pwd) {\n  var map_options = {\n    zoom: zoom,\n    center: center,\n    mapTypeId: google.maps.MapTypeId.ROADMAP\n  };\n  this.map = new google.maps.Map($(selector)[0], map_options);\n  this.bounds = new google.maps.LatLngBounds();\n  this.usr = usr;\n  this.pwd = pwd;\n\n  map = this.map;\n};\n\nItemMap.draw = function (data) {\n  $(data).each(function (key, doc) {\n\n    var lat = parseFloat(doc['lat']);\n    var lng = parseFloat(doc['lng']);\n    var p = new google.maps.LatLng(lat, lng);\n\n    ItemMap.bounds.extend(p);\n\n    var m = ItemMap.mark(p);\n    var infoWindow = new google.maps.InfoWindow();\n    var html = '<h4>' + doc['address'] + '</h4>';\n    var ex = [\"item_id\", \"document_id\", \"lat\", \"lng\", \"_version_\", \"latlong\"];\n\n    $.each(doc, function (k, v) {\n      if ($.inArray(k, ex) == -1) {\n        html += '<p>' + k + ': ' + v + '</p>';\n      }\n    });\n\n    google.maps.event.addListener(m, 'click', function () {\n      infoWindow.setContent(html);\n      infoWindow.open(ItemMap.map, m);\n    });\n\n    var center = new google.maps.LatLng(lat, lng);\n    map.panTo(center);\n  });\n};\n\nItemMap.mark = function (p) {\n  return new google.maps.Marker({\n    position: p,\n    map: ItemMap.map\n  });\n};\n\nGrid.init = function (table) {\n  this.table = table;\n};\n\nGrid.draw = function (data) {\n  var ex = [\"_version_\", \"latlong\", \"id\", \"item_id\", \"document_id\"];\n  var html = '<thead><tr>';\n\n  $.each(data[0], function (k, v) {\n    if ($.inArray(k, ex) == -1) {\n      html += '<th>' + k + '</th>';\n    }\n  });\n\n  html += '</tr></thead><tbody>';\n\n  $(data).each(function (key, doc) {\n    html += '<tr>';\n    $.each(doc, function (k, v) {\n      if ($.inArray(k, ex) == -1) {\n        html += '<td>' + v + '</td>';\n      }\n    });\n    html += '</tr>';\n  });\n\n  html += '</tbody>';\n\n  this.table.append(html);\n};\n\n//Dropzone.autoDiscover = false;\n\n$(function () {\n\n  $(document).ready(function () {\n    selectNavItem('solr');\n  });\n\n  if ($('#map').length) {\n    var center = new google.maps.LatLng($('#maps-lat').val(), $('#maps-lng').val());\n\n    ItemMap.init('#map', center, 6);\n\n    Grid.init($('#solr-table table'));\n\n    //Solr Markers\n    $.ajax({\n      url: $('#solr-url').val() + $('#solr-core').val() + '/select?',\n      data: 'q=*:*&d=20&rows=1000&start=0&fq={!geofilt sfield=latlong}&pt=' + $('#maps-lat').val() + ',' + $('#maps-lng').val() + '&d=100',\n      dataType: 'jsonp',\n      headers: {\n        \"Authorization\": \"Basic \" + btoa($('#solr-usr').val() + ':' + $('#solr-pwd').val())\n      }\n    }).done(function (r) {\n      var docs = r['response']['docs'];\n      ItemMap.draw(docs);\n      Grid.draw(docs);\n    });\n  }\n\n  $('#btn-view').on('click', function () {\n    $('.page-view').toggle();\n    $(this).find('span').toggleClass('fa-map');\n    $(this).find('span').toggleClass('fa-table');\n  });\n\n  $('#btn-import').on('click', function () {\n    document.location = '/solr/import';\n  });\n\n  $('#btn-search').on('click', function () {\n    document.location = '/solr/';\n  });\n\n  $('#uploads').on('click', '#btn-new', function () {\n    document.location = '/solr/import';\n  });\n\n  $('.show-detail').on('click', function () {\n    $(this).text($(this).text() == \"Show\" ? \"Hide\" : \"Show\");\n  });\n\n  $('#btn-help').on('click', function () {\n    $('div.import-help').toggle();\n  });\n\n  $('#btn-columns').on('click', function () {\n    $('#ul-columns').toggle();\n  });\n  function toggleHelp() {\n    $('#upload').hide();\n    $('p.import-help').hide();\n  }\n  /*\n    $(\"body\").dropzone({\n      url: '/solr/import',\n      maxFilesize: 2,\n      maxFiles: 1,\n      acceptedFiles: '.csv',\n      previewsContainer: \"#uploads\",\n      clickable: \"#upload\",\n      paramName: \"file\",\n  \n      sending: function sending(xhr, frmData) {\n        console.log(frmData);\n        toggleHelp();\n      },\n  \n      success: function success(file, response) {\n        console.log(response);\n        if (response['status'] !== 'danger') {\n  \n          var successMsg = '<div class=\"text-success\">' + response['msg'] + '</div>';\n          var newUpload = '<div><button id=\"btn-new\" class=\"btn btn-success\" type=\"button\">New Upload</button>';\n  \n          $('div.dz-success-mark').append(successMsg).append(newUpload).fadeIn('slow');\n        } else {\n  \n          showError(response);\n        }\n      },\n      error: function error(file, response) {\n        showError(response);\n      }\n    });\n  */\n  function showError(response) {\n    console.log(response);\n    toggleHelp();\n    $('div.dz-error-mark').fadeIn('slow');\n    if (response['msg']) {\n      $('div.dz-error-message  span').html(response['msg']);\n    } else {\n      $('div.dz-error-message  span').html(response);\n    }\n    $('div.dz-error-mark').prepend('<div class=\"dz-error-link\"><a href=\"/solr/import\" class=\"btn btn-danger\" title=\"Back\">Start Again</a></div>');\n  }\n});\n//# sourceMappingURL=solr.js.map\n//# sourceMappingURL=solr.js.map\n//# sourceMappingURL=solr.js.map\n"]}